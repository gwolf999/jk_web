define(function(){function t(){return $(window).scrollTop()+$(window).height()}function e(){return window.sSession&&window.sSession.isLogin&&"1"===window.sSession.isLogin}function a(){var t=location.href.match(/from=([^&/]*)/),a={query:"wise_index",cp:"wise_home_page",pui:e()?1:0,pn:++S,from:t?t[1]:"0",wsw:screen.availWidth,wsh:screen.availHeight,wiw:$(window).width(),wih:$(window).height(),sid:window.sSession&&window.sSession.logid||"",wosid:window.sSession&&window.sSession.osid||"",wbwsid:window.sSession&&window.sSession.browserid||"",nettype:window.sSession&&window.sSession.netType||0};
return a}function n(){return y[S+1]||g}function i(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var a in e)new RegExp("("+a+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?e[a]:("00"+e[a]).substr((""+e[a]).length)));return t}function o(t){if(t){var e=(new Date).getTime(),a=new Image;
t+="&rand="+(e+Math.random()),a.onload=a.onerror=a.onabort=function(){a.onload=a.onerror=a.onabort=null,a=null},a.src=t}}function s(t){var e={tag:"wise_home",action:"renderfail",pn:S,sid:window.B.cookie("H_WISE_SIDS"),pre_qid:window.sSession&&window.sSession.logid||"",extends_1:JSON&&JSON.stringify(I)};e=$.extend(e,t||{}),o(T+"?"+r(e))}function r(t){var e=[];for(var a in t)t.hasOwnProperty(a)&&e.push(encodeURIComponent(a)+"="+encodeURIComponent(t[a]));return e.join("&")}function d(){var e=t(),a=$(".ads-item");
a.each(function(t,a){var i=$(a),o=i.offset().top;if("true"!==i.attr("data-init")){var s=o-e,r=n();x&&s>=10&&r>=s&&(i.attr("data-init","true"),I.startPos=e,I.adPos=o,I.startTime&&(I.lastTime=I.startTime),w(i))}}),clearTimeout(p),p=setTimeout(c,150)}function c(){var e=t(),a=$(".ads-item");a.each(function(t,a){var n=$(a),o=n.offset().top,r=n.find("a");if(n.height()>0&&r.length>0&&e>o){var d=r.attr("data-pos"),c=r.attr("data-pn"),w=n.attr("data-apr")||0;w&&(w=+w);var u={},f=(e-o)/n.height();f=f>1?1:f,u.apr=+f.toFixed(2),u.apr>w&&(n.attr("data-apr",u.apr),s({action:"adsshow",pn:c,extends_1:JSON&&JSON.stringify(u),extends_2:d}));
var h=r.attr("data-show"),l=r.attr("data-rank"),p=r.attr("data-adid"),m=r.attr("data-searchId"),g=r.attr("data-src");"true"!==h&&e-o>.3*n.height()&&(r.attr("data-show","true"),s({action:"adsexposure",baiduid:window.B&&window.B.cookie&&window.B.cookie("BAIDUID"),searchId:m,rank:l||1,adid:p,src:g||1026,time:i.call(new Date,"yyyy-MM-dd HH:mm:ss"),ck:"",pn:c,extends_1:u.apr,extends_2:d}),window.B.log.send({ct:10,cst:10,clk_from:"mid_news",rids:r.attr("data-rid"),pos:r.attr("data-pos"),searchId:m}))}})
}function w(e){u();var n=e.attr("data-pos");e.removeAttr("data-rid"),e.removeAttr("data-pos");var i=v;m&&(i=v+"&show_info="+m),$.ajax({url:i,type:"GET",dataType:"jsonp",timeout:1500,data:a()}).done(function(a){f(e);var i=t(),o=e.offset().top;if(0!==a.err_no)return void s({action:"requestfail_1",extends_2:n});if(a.ad_place_list.length<=0||!a.ad_place_list[0].ad_place_data)return void s({action:"adsempty",extends_2:n});if(o>i+_){var r=e.html(a.ad_place_list[0].ad_place_data).find("a"),d=r.attr("data-searchId")||Math.floor(1e17*Math.random());
r.attr({"data-rid":"ecomads-"+d+"-"+S,"data-pos":n,"data-pn":S});var c=r.attr("data-showinfo");return c&&(m=c),void s({action:"rendersuccess",extends_2:n})}s({action:"renderfail",extends_2:n})}).fail(function(){f(e),s({action:"requestfail_2",extends_2:n})})}function u(){I.startTime=(new Date).getTime(),I.interval=I.startTime-I.lastTime}function f(e){I.endTime=(new Date).getTime(),I.requestTime=I.endTime-I.startTime;var a=t(),n=e.offset().top;I.endPos=a,I.distance=n-a}function h(){var t=$("[name=word]");
t.on("focus",function(){x=!1}),t.on("blur",function(){x=!0}),$(window).on("scroll",d)}function l(){h()}var p,m,g=500,_=5,v="//ada.baidu.com/common/?_api=new",T="http:"===location.protocol?"http://fclick.baidu.com/w.gif":"https://sp0.baidu.com/-rU_dTmfKgQFm2e88IuM_a/w.gif",S=0,x=!0,y={},I={height:$(window).height(),interval:0,lastTime:(new Date).getTime(),startTime:0,endTime:0,startPos:0,endPos:0,adPos:0,requestTime:0,distance:0};return{init:l}});